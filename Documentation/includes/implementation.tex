\chapter{Umsetzung}
\label{sec:Umsetzung}
Im Kapitel \nameref{sec:Umsetzung} werden die einzelnen Schritte der Implementierung des Spielkonzepts beschrieben. Hierbei wird auf die unterschiedlichen Komponenten des Spiels eingegangen sowie auf die Schwierigkeiten, die bei der Implementierung aufgetreten sind.

\section{Implementierung des A* Algorithmus}
\label{sec:implementAStar}
\todo{Christian}
\section{ImageTargets}
Wie im Kapitel \nameref{sec:rec_imageTargets} \ref{sec:rec_imageTargets} beschrieben, wurden vier unterschiedliche ImageTargets entworfen und in die Vuforia Datenbank geladen. Hierbei handelt es sich um Bilder von Gegenständen, die einem Studenten den Uni Alltag immer wieder erschweren. Bei den Gegenständen handelt es sich um die Mensa, Pizza, Bier und die Straßenbahn. Die Mensa steht für die komplizierte Platzsuche in einer überfüllten Mensa. Die Pizza repräsentiert das Ausweichessen, was es jeden Tag zu Hause gibt, wenn der Kühlschrank mal wieder leer ist. Das Bier steht für die Verlockung an einem sonnigen Abend den Stift fallen zu lassen und Bier zu trinken. Die Straßenbahn steht stellvertretend für die langen Anfahrtswege zur Uni.\\
Die ImageTargets haben sich im Laufe des Projekts den Anforderungen entsprechend verändert. Durch das Ranking in der Vuforia Datenbank stellte sich heraus, dass die ersten Entwürfe (siehe Abbildung \ref{fig:impl_imageTargets}) der ImageTargets einen schlechten Wiedererkennungswert aufwiesen. Aus diesem Grund mussten die Referenzbilder für die ImageTarget Detection überarbeitet werden. Durch die Anpassung der Bilder hat sich das Ranking durch die Vuforia Datenbank deutlich verbessert (siehe Abbildung \ref{fig:impl_vuforiaRanking}). Diese Verbesserung hat dazu beigetragen, dass die Bilder in der Anwendung auf auf größere Entfernungen besser erkannt und verfolgt werden konnten.
\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.2\textwidth}
        \includegraphics[width=\textwidth]{assets/mensa.jpg}
        \caption{Mensa Erstentwurf}
        \label{fig:oldMensa}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.2\textwidth}
        \includegraphics[width=\textwidth]{assets/mensa_new.jpg}
        \caption{Überarbeitete Mensa}
        \label{fig:newMensa}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.2\textwidth}
        \includegraphics[width=\textwidth]{assets/tram.png}
        \caption{Tram Erstentwurf}
        \label{fig:oldTram}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.2\textwidth}
        \includegraphics[width=\textwidth]{assets/tram_new.jpg}
        \caption{Überarbeitete Straßenbahn}
        \label{fig:newTram}
    \end{subfigure}
    \caption{Entwicklung der ImageTargets}\label{fig:impl_imageTargets}
\end{figure}

\begin{figure}[h]
        \includegraphics[width=\textwidth]{assets/vuforiaImageRanking}
        \caption{Vuforia Ranking}
        \label{fig:impl_vuforiaRanking}
\end{figure}

\section{Erkennung von Objekten}
Wie in Kapitel \ref{sec:vufObjRec} beschrieben müssen die eingescannten Objekte in eine Vuforia Datenbank importiert werden (siehe Abb. \ref{fig:vuforiaObjectDatabase}). Diese Datenbank wird im Vuforia Developer Portal zur Verfügung gestellt und ist mit wenigen Klicks eingerichtet. Diese Datenbank lässt sich für unterschiedliche Entwicklungsplattformen herunterladen. Unter anderem auch für die Unity IDE als package. Um die Objekte nun in der Unity Scene verwenden zu können, muss das Package per Import Package Funktion in Unity geladen werden.
\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{assets/vuforiaDataBase.jpeg}
    \caption{Vuforia Datenbank}\label{fig:vuforiaObjectDatabase}
\end{figure}\\
Vuforia bietet die Möglichkeit in Unity 3d Scan Objekte als Gameobjekt anzulegen. Bei dem angelegten Objekt kann nun die importierte Datenbank und das wiederzuerkennende Objekt ausgewählt werden. \\
In der Szene erscheint nun eine Bounding Box. Laut der Vuforia Dokumentation\cite{VufObjRec}  sollte die Bounding Box den Maßen des eingescannten Objektes entsprechen. Dies ist bei der Durchführung jedoch nicht der Fall gewesen. Die Objekte haben einen Nullpunkt. (siehe Abb. \ref{fig:matches}) Der Nullpunkt wird von der Schablone welche zum Einscannen genutzt wird, übernommen. Die Bounding Box bietet sich gut an, um Objekte auf dem eingescannten Objekt zu platzieren. Jedoch ist die Länge vom Nullpunkt bis zum Ende des Objektes nicht bekannt. Auch rechteckige Objekte werden durch eine quadratische Bounding Box dargestellt. Durch diesen Umstand kann keine präzise Bounding Box generiert werden, die das reale Objekt in der Scene widerspiegelt.\\
\begin{figure}[h]
    \centering
    \includegraphics[width=0.5\linewidth]{assets/matches.png}
    \caption{Eingescanntes Objekt mit Nullpunkt}\label{fig:matches}
\end{figure}\\
Dem in der Scene befindlichen 3d Scan Game Object kann nun der \textit{unwalkable Layer} zugewiesen werden siehe \ref{sec:implementAStar} \nameref{sec:implementAStar}. Im Test reagierte der A* Algorithmus nicht auf die realen Objekte, da diese sich nicht auf der selben Ebene befinden wie das Spielfeld. Durch diesen Umstand haben wir den \textit{DefaultTrackableEventHandler} von Vuforia erweitert. Hierfür wurde ein eigenes Script implementiert, welches die eingescannten Objecte bei jedem Update auf die Position 0 der y-Achse transformiert. So wird sichergestellt, dass sich das reale Objekt und das Spielfeld auf der selben Ebene befinden. Das reale Objekt wurde daraufhin von den Nodes des A* Grids als unwalkable erkannt. \\
Um die Objekte in die Scene des Spielers zu integrieren muss sich die Kamera exakt über dem Spielfeld befinden. Eine Third Person Ansicht ist nicht möglich, da die erkannten Objekte von der Position der Kamera ausgehen. Steht die Kamera Beispielsweise auf xyz(0,-20, -20), erhält das gescannte Objekt ebenfalls diese Koordinaten. Wird das Objekt in der realen Welt bewegt, verändern sich die Koordinaten, allerdings ausgehend von der Kamera Position. Durch diesen Umstand muss die Kamera exakt in der Mitte des Spielfelds befinden, damit die realen Objekte ausgehend von diesem Punkt platziert werden können.

\section{UI}
Wie in Abbildung \ref{fig:uiElements} zu sehen ist, besteht das User Interface für die RunnAR Anwendung aus zwei unterschiedlichen Ansichten. Zum Einen ist in Abbildung \ref{fig:uiMenu}) das Startmenü zu sehen. Hierbei hat der Nutzer die Möglichkeit die Anwendung zu verlassen indem der Exit Button geklickt wird, oder das Spiel kann durch den Start Button gestartet werden. Zum Anderen besteht die Anwendung aus der Spielansicht (siehe Abbildung \ref{fig:uiGame}). Die Spielansicht beinhaltet einen Replay Button, einen Timer sowie den Spieler und alle Interaktionselemente für den Spieler. Durch den Replay Button lässt sich der derzeitige Spielstand zurücksetzen und von Neuem beginnen. Der Timer läuft von 90 Sekunden bis 0. Ist die Zeit abgelaufen ist die Spielrunde beendet. Das UI der Anwendung befindet sich in einem prototypischen Zustand, der eine einfache Bedienung ermöglicht.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=\textwidth]{assets/uiMenu}
        \caption{UI Menüansicht}
        \label{fig:uiMenu}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.3\textwidth}
        \includegraphics[width=\textwidth]{assets/uiGame}
        \caption{UI Spielansicht}
        \label{fig:uiGame}
    \end{subfigure}
    \caption{User Interface Elemente}\label{fig:uiElements}
\end{figure}

